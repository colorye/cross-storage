Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t,e=(t=require("nanoid/generate"))&&t.__esModule?t:{default:t};function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var i=new function(){n(this,"open",(function(t){void 0===t&&(t=[]),this.t=function(e){var n="null"===e.origin?"file://":e.origin;if(t.some((function(t){return!(!t instanceof RegExp)&&t.test(n)}))){var i=function(){try{return JSON.parse(e.data)}catch(t){return}}();if(i){var o=function(){try{var t,e=i.method.split("CrossStorage:")[1];return JSON.stringify({id:i.id,result:(t=localStorage)[e].apply(t,i.params)})}catch(t){return JSON.stringify({id:i.id,error:t})}}();window.parent.postMessage(o,n)}}},window.addEventListener?window.addEventListener("message",this.t.bind(this),!1):window.attachEvent("onmessage",this.t.bind(this))})),n(this,"close",(function(){window.removeEventListener?window.removeEventListener("message",this.t,!1):window.detachEvent("onmessage",this.t)})),n(this,"connect",(function(t,n){var i=this,o=void 0===n?{}:n,s=o.frameId,r=void 0===s?"cross-storage":s,u=o.callback;if("CONNECTED"===this.i)return"function"==typeof u&&u(this),this;var a=document.getElementById(r);return a?console.error("ERROR: "+r+" has already be used. Please provide different frameId"):(a=window.document.createElement("iframe"),this.o=a,this.o.id=r,this.o.style.display="none",window.document.body.appendChild(this.o),this.o.src=t,this.s=function(e){if(("null"===e.origin?"file://":e.origin)===t){var n=function(){try{return JSON.parse(e.data)}catch(t){}}();n.id&&"function"==typeof this.u[n.id]&&this.u[n.id](n.error,n.result)}},window.addEventListener?window.addEventListener("message",this.s.bind(this),!1):window.attachEvent("onmessage",this.s.bind(this)),new Promise((function(t){i.o.onload=function(){i.i="CONNECTED",i.u={},i.h=function(t,n){var i=this;if("CONNECTED"!==this.i)return console.error("ERROR: CrossStorage has not been up yet.");var o={id:(0,e.default)("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",10),method:"CrossStorage:"+t,params:n};return new Promise((function(t,e){i.m=setTimeout((function(){i.u[o.id]&&(delete i.u[o.id],e(new Error("timeout")))}),5e3),i.u[o.id]=function(n,s){if(clearTimeout(i.m),delete i.u[o.id],n)return e(new Error(n));t(s)},i.o.contentWindow.postMessage(JSON.stringify(o),i.o.src)})).catch((function(t){console.error("ERROR: ",t)}))},"function"==typeof u&&u(i),t(i)}})))})),n(this,"disconnect",(function(){this.o&&this.o.parentNode.removeChild(this.o),this.i="DISCONNECTED",window.removeEventListener?window.removeEventListener("message",this.s,!1):window.detachEvent("onmessage",this.s)})),n(this,"getItem",(function(t){return this.h("getItem",[t])})),n(this,"setItem",(function(t,e){return this.h("setItem",[t,e])})),n(this,"removeItem",(function(t){return this.h("removeItem",[t])}))};exports.default=i;