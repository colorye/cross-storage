Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e,t=(e=require("nanoid/generate"))&&e.__esModule?e:{default:e};function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=new function(){n(this,"open",(function(e){void 0===e&&(e=[]),this.__rootListener=function(t){var n=this,i="null"===t.origin?"file://":t.origin;if(e.some((function(e){return!(!e instanceof RegExp)&&e.test(i)}))){var r=function(){try{return JSON.parse(t.data)}catch(e){return}}();if(r){var s=function(){try{var e=r.method.split("CrossStorage:")[1];return JSON.stringify({id:r.id,result:n["__"+e](r.params)})}catch(e){return JSON.stringify({id:r.id,error:e})}}();window.parent.postMessage(s,i)}}},window.addEventListener?window.addEventListener("message",this.__rootListener.bind(this),!1):window.attachEvent("onmessage",this.__rootListener.bind(this))})),n(this,"close",(function(){window.removeEventListener?window.removeEventListener("message",this.__rootListener,!1):window.detachEvent("onmessage",this.__rootListener)})),n(this,"__getItem",(function(e){var t=e.key;return window.localStorage.getItem(t)})),n(this,"__setItem",(function(e){var t=e.key,n=e.value;return window.localStorage.setItem(t,n)})),n(this,"__removeItem",(function(e){var t=e.key;return window.localStorage.removeItem(t)})),n(this,"connect",(function(e,t){var n=this,i=void 0===t?{}:t,r=i.frameId,s=void 0===r?"cross-storage":r,o=i.callback;if("CONNECTED"===this.__connectionStatus)return"function"==typeof o&&o(this),this;var a=document.getElementById(s);return a?console.error("ERROR: "+s+" has already be used. Please provide different frameId"):(a=window.document.createElement("iframe"),this.__frame=a,this.__frame.id=s,this.__frame.style.display="none",window.document.body.appendChild(this.__frame),this.__frame.src=e,this.__clientListener=function(t){if(("null"===t.origin?"file://":t.origin)===e){var n=function(){try{return JSON.parse(t.data)}catch(e){}}();n.id&&"function"==typeof this.__requests[n.id]&&this.__requests[n.id](n.error,n.result)}},window.addEventListener?window.addEventListener("message",this.__clientListener.bind(this),!1):window.attachEvent("onmessage",this.__clientListener.bind(this)),new Promise((function(e){n.__frame.onload=function(){n.__connectionStatus="CONNECTED",n.__requests={},"function"==typeof o&&o(n),e(n)}})))})),n(this,"disconnect",(function(){this.__frame&&this.__frame.parentNode.removeChild(this.__frame),this.__connectionStatus="DISCONNECTED",window.removeEventListener?window.removeEventListener("message",this.__clientListener,!1):window.detachEvent("onmessage",this.__clientListener)})),n(this,"getItem",(function(e){return this.__request("getItem",{key:e})})),n(this,"setItem",(function(e,t){return this.__request("setItem",{key:e,value:t})})),n(this,"removeItem",(function(e){return this.__request("removeItem",{key:e})})),n(this,"__request",(function(e,n){var i=this;if("CONNECTED"!==this.__connectionStatus)return console.error("ERROR: CrossStorage has not been up yet.");var r={id:(0,t.default)("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",10),method:"CrossStorage:"+e,params:n};return new Promise((function(e,t){i.__timeout=setTimeout((function(){i.__requests[r.id]&&(delete i.__requests[r.id],t(new Error("timeout")))}),5e3),i.__requests[r.id]=function(n,s){if(clearTimeout(i.__timeout),delete i.__requests[r.id],n)return t(new Error(n));e(s)},i.__frame.contentWindow.postMessage(JSON.stringify(r),i.__frame.src)})).catch((function(e){console.error("ERROR: ",e)}))}))};exports.default=i;