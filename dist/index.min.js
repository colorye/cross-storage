Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=i(require("nanoid/generate")),t=i(require("js-cookie"));function i(e){return e&&e.__esModule?e:{default:e}}function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var o=new function(){n(this,"open",(function(e){void 0===e&&(e=[]),this.t=function(i){var n="null"===i.origin?"file://":i.origin;if(e.some((function(e){return!(!e instanceof RegExp)&&e.test(n)}))){var o=function(){try{return JSON.parse(i.data)}catch(e){return}}();if(o){var r=function(){try{var e=o.method.split("CrossStorage:")[1],i=function(){var i,n,r;switch(e){case"getItem":return(i=localStorage).getItem.apply(i,o.params);case"setItem":return(n=localStorage).setItem.apply(n,o.params);case"removeItem":return(r=localStorage).removeItem.apply(r,o.params);case"getCookie":return t.default.get.apply(t.default,o.params);case"setCookie":return t.default.set.apply(t.default,o.params);case"removeCookie":return t.default.remove.apply(t.default,o.params);default:return}}();return JSON.stringify({id:o.id,result:i})}catch(e){return JSON.stringify({id:o.id,error:e})}}();window.parent.postMessage(r,n)}}},window.addEventListener?window.addEventListener("message",this.t.bind(this),!1):window.attachEvent("onmessage",this.t.bind(this))})),n(this,"close",(function(){window.removeEventListener?window.removeEventListener("message",this.t,!1):window.detachEvent("onmessage",this.t)})),n(this,"connect",(function(t,i){var n=this,o=void 0===i?{}:i,r=o.frameId,s=void 0===r?"cross-storage":r,u=o.callback;if("CONNECTED"===this.i)return"function"==typeof u&&u(this),this;var c=document.getElementById(s);return c?console.error("ERROR: "+s+" has already be used. Please provide different frameId"):(c=window.document.createElement("iframe"),this.o=c,this.o.id=s,this.o.style.display="none",window.document.body.appendChild(this.o),this.o.src=t,this.s=function(e){if(("null"===e.origin?"file://":e.origin)===t){var i=function(){try{return JSON.parse(e.data)}catch(e){}}();i&&i.id&&"function"==typeof this.u[i.id]&&this.u[i.id](i.error,i.result)}},window.addEventListener?window.addEventListener("message",this.s.bind(this),!1):window.attachEvent("onmessage",this.s.bind(this)),new Promise((function(t){n.o.onload=function(){n.i="CONNECTED",n.u={},n.h=function(t,i){var n=this;if("CONNECTED"!==this.i)return console.error("ERROR: CrossStorage has not been up yet.");var o={id:(0,e.default)("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",10),method:"CrossStorage:"+t,params:i};return new Promise((function(e,t){n.m=setTimeout((function(){n.u[o.id]&&(delete n.u[o.id],t(new Error("timeout")))}),5e3),n.u[o.id]=function(i,r){if(clearTimeout(n.m),delete n.u[o.id],i)return t(new Error(i));e(r)},n.o.contentWindow.postMessage(JSON.stringify(o),n.o.src)})).catch((function(e){console.error("ERROR: ",e)}))},"function"==typeof u&&u(n),t(n)}})))})),n(this,"disconnect",(function(){this.o&&this.o.parentNode.removeChild(this.o),this.i="DISCONNECTED",window.removeEventListener?window.removeEventListener("message",this.s,!1):window.detachEvent("onmessage",this.s)})),n(this,"getItem",(function(e){return this.h("getItem",[e])})),n(this,"setItem",(function(e,t){return this.h("setItem",[e,t])})),n(this,"removeItem",(function(e){return this.h("removeItem",[e])})),n(this,"getCookie",(function(e){return this.h("getCookie",[e])})),n(this,"setCookie",(function(e,t){return this.h("setCookie",[e,t])})),n(this,"removeCookie",(function(e){return this.h("removeCookie",[e])}))};exports.default=o;