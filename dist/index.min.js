Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("nanoid/generate")),e=i(require("js-cookie"));function i(t){return t&&t.__esModule?t:{default:t}}function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var o=new function(){n(this,"open",(function(t){void 0===t&&(t=[]),this.t=function(i){var n="null"===i.origin?"file://":i.origin;if(t.some((function(t){return!(!t instanceof RegExp)&&t.test(n)}))){var o=function(){try{return JSON.parse(i.data)}catch(t){return}}();if(o){var r=function(){try{var t=o.method.split("CrossStorage:")[1],i="function"==typeof localStorage[t]?(n=localStorage)[t].apply(n,o.params):"function"==typeof e.default[t]?e.default[t].apply(e.default,o.params):void 0;return JSON.stringify({id:o.id,result:i})}catch(t){return JSON.stringify({id:o.id,error:t})}var n}();window.parent.postMessage(r,n)}}},window.addEventListener?window.addEventListener("message",this.t.bind(this),!1):window.attachEvent("onmessage",this.t.bind(this))})),n(this,"close",(function(){window.removeEventListener?window.removeEventListener("message",this.t,!1):window.detachEvent("onmessage",this.t)})),n(this,"connect",(function(e,i){var n=this,o=void 0===i?{}:i,r=o.frameId,s=void 0===r?"cross-storage":r,u=o.callback;if("CONNECTED"===this.i)return"function"==typeof u&&u(this),this;var c=document.getElementById(s);return c?console.error("ERROR: "+s+" has already be used. Please provide different frameId"):(c=window.document.createElement("iframe"),this.o=c,this.o.id=s,this.o.style.display="none",window.document.body.appendChild(this.o),this.o.src=e,this.s=function(t){if(("null"===t.origin?"file://":t.origin)===e){var i=function(){try{return JSON.parse(t.data)}catch(t){}}();i.id&&"function"==typeof this.u[i.id]&&this.u[i.id](i.error,i.result)}},window.addEventListener?window.addEventListener("message",this.s.bind(this),!1):window.attachEvent("onmessage",this.s.bind(this)),new Promise((function(e){n.o.onload=function(){n.i="CONNECTED",n.u={},n.h=function(e,i){var n=this;if("CONNECTED"!==this.i)return console.error("ERROR: CrossStorage has not been up yet.");var o={id:(0,t.default)("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",10),method:"CrossStorage:"+e,params:i};return new Promise((function(t,e){n.m=setTimeout((function(){n.u[o.id]&&(delete n.u[o.id],e(new Error("timeout")))}),5e3),n.u[o.id]=function(i,r){if(clearTimeout(n.m),delete n.u[o.id],i)return e(new Error(i));t(r)},n.o.contentWindow.postMessage(JSON.stringify(o),n.o.src)})).catch((function(t){console.error("ERROR: ",t)}))},"function"==typeof u&&u(n),e(n)}})))})),n(this,"disconnect",(function(){this.o&&this.o.parentNode.removeChild(this.o),this.i="DISCONNECTED",window.removeEventListener?window.removeEventListener("message",this.s,!1):window.detachEvent("onmessage",this.s)})),n(this,"getItem",(function(t){return this.h("getItem",[t])})),n(this,"setItem",(function(t,e){return this.h("setItem",[t,e])})),n(this,"removeItem",(function(t){return this.h("removeItem",[t])})),n(this,"getCookie",(function(t){return this.h("get",[t])})),n(this,"setCookie",(function(t,e){return this.h("set",[t,e])})),n(this,"removeCookie",(function(t){return this.h("remove",[t])}))};exports.default=o;